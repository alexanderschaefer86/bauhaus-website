<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bauhaus â€” Form Follows Function</title>
<!-- Three.js import map (3D experience requires localhost, not file://) -->
<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.170.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.170.0/examples/jsm/"
  }
}
</script>
<style>
  /* ===== RESET & BASE ===== */
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --red: #BE1E2D;
    --yellow: #F2C12E;
    --blue: #1B3DA6;
    --black: #1A1A1A;
    --white: #F5F1EB;
    --gray: #B0ACA5;
    --dark-gray: #3A3A3A;
  }

  html { scroll-behavior: smooth; }

  body {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    background: var(--white);
    color: var(--black);
    line-height: 1.6;
    overflow-x: hidden;
  }

  /* ===== TYPOGRAPHY ===== */
  h1, h2, h3, h4 {
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    line-height: 1.1;
  }

  /* ===== NAVIGATION ===== */
  nav {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 100;
    background: var(--black);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 2rem;
    height: 56px;
  }

  nav .logo {
    color: var(--white);
    font-size: 1.1rem;
    font-weight: 700;
    letter-spacing: 0.15em;
    text-transform: uppercase;
  }

  nav .logo span { color: var(--yellow); }

  nav ul {
    list-style: none;
    display: flex;
    gap: 0.25rem;
  }

  nav ul li a {
    color: var(--gray);
    text-decoration: none;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    padding: 0.5rem 0.75rem;
    transition: color 0.2s;
    display: block;
  }

  nav ul li a:hover { color: var(--white); }

  /* ===== HERO ===== */
  .hero {
    min-height: 100vh;
    display: grid;
    grid-template-columns: 1fr 1fr;
    padding-top: 56px;
  }

  .hero-left {
    background: var(--black);
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 4rem;
    position: relative;
    overflow: hidden;
  }

  .hero-left h1 {
    color: var(--white);
    font-size: clamp(3rem, 6vw, 5.5rem);
    line-height: 0.95;
    position: relative;
    z-index: 2;
  }

  .hero-left h1 .line-2 { color: var(--yellow); }
  .hero-left h1 .line-3 { color: var(--red); }

  .hero-left p {
    color: var(--gray);
    margin-top: 2rem;
    font-size: 0.95rem;
    max-width: 400px;
    position: relative;
    z-index: 2;
  }

  .hero-geo {
    position: absolute;
    opacity: 0.08;
    z-index: 1;
  }

  .hero-geo.circle {
    width: 300px;
    height: 300px;
    border-radius: 50%;
    border: 40px solid var(--yellow);
    top: -60px;
    right: -80px;
  }

  .hero-geo.triangle {
    width: 0;
    height: 0;
    border-left: 120px solid transparent;
    border-right: 120px solid transparent;
    border-bottom: 200px solid var(--red);
    bottom: 40px;
    left: -40px;
  }

  .hero-right {
    display: grid;
    grid-template-rows: 1fr 1fr;
    grid-template-columns: 1fr 1fr;
  }

  .hero-cell {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
    cursor: pointer;
    transition: transform 0.3s;
  }

  .hero-cell:nth-child(1) { background: var(--red); }
  .hero-cell:nth-child(2) { background: var(--blue); }
  .hero-cell:nth-child(3) { background: var(--yellow); }
  .hero-cell:nth-child(4) { background: var(--white); border: 1px solid #ddd; }

  .hero-cell .shape {
    transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  .hero-cell:hover .shape { transform: rotate(90deg) scale(1.1); }

  .hero-cell .shape.circle-shape {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: var(--white);
  }

  .hero-cell .shape.square-shape {
    width: 70px;
    height: 70px;
    background: var(--white);
  }

  .hero-cell .shape.triangle-shape {
    width: 0;
    height: 0;
    border-left: 45px solid transparent;
    border-right: 45px solid transparent;
    border-bottom: 78px solid var(--black);
  }

  .hero-cell .shape.line-shape {
    width: 100px;
    height: 6px;
    background: var(--black);
    transform: rotate(-45deg);
  }

  .hero-cell:hover .shape.line-shape { transform: rotate(45deg); }

  .hero-cell .cell-label {
    position: absolute;
    bottom: 12px;
    right: 14px;
    font-size: 0.55rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    opacity: 0.5;
  }

  .hero-cell:nth-child(1) .cell-label,
  .hero-cell:nth-child(2) .cell-label { color: var(--white); }
  .hero-cell:nth-child(3) .cell-label,
  .hero-cell:nth-child(4) .cell-label { color: var(--black); }

  /* ===== SECTION TITLES ===== */
  .section-header {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 1.5rem;
    align-items: center;
    margin-bottom: 3rem;
  }

  .section-number {
    font-size: 4rem;
    font-weight: 700;
    line-height: 1;
    color: var(--gray);
    opacity: 0.4;
  }

  .section-header h2 {
    font-size: clamp(1.5rem, 3vw, 2.2rem);
  }

  .section-header .accent-bar {
    height: 4px;
    margin-top: 0.5rem;
  }

  /* ===== HISTORY SECTION ===== */
  #history {
    padding: 6rem 4rem;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    align-items: start;
  }

  #history .text-col {
    max-width: 520px;
  }

  #history .text-col p {
    margin-top: 1.2rem;
    color: var(--dark-gray);
    font-size: 0.95rem;
  }

  .timeline {
    position: relative;
    padding-left: 2rem;
    border-left: 3px solid var(--black);
  }

  .timeline-item {
    margin-bottom: 2rem;
    position: relative;
    padding-left: 1.5rem;
  }

  .timeline-item::before {
    content: '';
    position: absolute;
    left: -2.35rem;
    top: 0.5rem;
    width: 12px;
    height: 12px;
    background: var(--red);
  }

  .timeline-item:nth-child(2)::before { background: var(--blue); border-radius: 50%; }
  .timeline-item:nth-child(3)::before { background: var(--yellow); }
  .timeline-item:nth-child(4)::before {
    background: transparent;
    border: 3px solid var(--black);
    border-radius: 50%;
    width: 12px;
    height: 12px;
  }

  .timeline-item h4 {
    font-size: 0.85rem;
    margin-bottom: 0.25rem;
  }

  .timeline-item p {
    font-size: 0.8rem;
    color: var(--dark-gray);
    line-height: 1.5;
  }

  /* ===== PRINCIPLES ===== */
  #principles {
    padding: 6rem 4rem;
    background: var(--black);
    color: var(--white);
  }

  #principles .section-header h2 { color: var(--white); }

  .principles-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2px;
  }

  .principle-card {
    background: var(--dark-gray);
    padding: 2.5rem 2rem;
    position: relative;
    overflow: hidden;
    transition: background 0.3s;
    cursor: default;
  }

  .principle-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
  }

  .principle-card:nth-child(1)::before { background: var(--red); }
  .principle-card:nth-child(2)::before { background: var(--blue); }
  .principle-card:nth-child(3)::before { background: var(--yellow); }
  .principle-card:nth-child(4)::before { background: var(--yellow); }
  .principle-card:nth-child(5)::before { background: var(--red); }
  .principle-card:nth-child(6)::before { background: var(--blue); }

  .principle-card:hover { background: #444; }

  .principle-card .card-icon {
    width: 48px;
    height: 48px;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .principle-card h3 {
    font-size: 0.95rem;
    margin-bottom: 0.75rem;
    letter-spacing: 0.1em;
  }

  .principle-card p {
    font-size: 0.82rem;
    color: var(--gray);
    line-height: 1.6;
  }

  /* Card icons via CSS shapes */
  .icon-function {
    width: 40px;
    height: 40px;
    border: 3px solid var(--red);
  }

  .icon-less {
    width: 40px;
    height: 3px;
    background: var(--blue);
  }

  .icon-unity {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 3px solid var(--yellow);
    position: relative;
  }

  .icon-unity::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 16px;
    height: 16px;
    background: var(--yellow);
  }

  .icon-geometry {
    width: 0;
    height: 0;
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-bottom: 34px solid var(--yellow);
  }

  .icon-typo {
    font-size: 2rem;
    font-weight: 700;
    color: var(--red);
    line-height: 1;
  }

  .icon-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 3px;
    width: 36px;
    height: 36px;
  }

  .icon-grid span {
    background: var(--blue);
    opacity: 0.6;
  }

  .icon-grid span:nth-child(1),
  .icon-grid span:nth-child(5),
  .icon-grid span:nth-child(9) { opacity: 1; }

  /* ===== INTERACTIVE COLOR SECTION ===== */
  #colors {
    padding: 6rem 4rem;
  }

  .color-lab {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    align-items: center;
  }

  .color-lab .text-col p {
    color: var(--dark-gray);
    font-size: 0.95rem;
    margin-top: 1rem;
  }

  .color-mixer {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .mixer-row {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .color-swatch {
    width: 64px;
    height: 64px;
    cursor: pointer;
    transition: transform 0.3s, box-shadow 0.3s;
    position: relative;
  }

  .color-swatch:hover { transform: scale(1.1); }
  .color-swatch.active {
    transform: scale(1.15);
    box-shadow: 0 0 0 3px var(--black);
  }

  .color-swatch[data-color="red"] { background: var(--red); }
  .color-swatch[data-color="yellow"] { background: var(--yellow); }
  .color-swatch[data-color="blue"] { background: var(--blue); }
  .color-swatch[data-color="black"] { background: var(--black); }
  .color-swatch[data-color="white"] { background: var(--white); border: 2px solid var(--black); }
  .color-swatch[data-color="gray"] { background: var(--gray); }

  .color-swatch .swatch-label {
    position: absolute;
    bottom: -18px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.55rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    white-space: nowrap;
  }

  .canvas-preview {
    width: 100%;
    aspect-ratio: 4 / 3;
    border: 2px solid var(--black);
    position: relative;
    overflow: hidden;
    cursor: crosshair;
  }

  .canvas-preview .placed-shape {
    position: absolute;
    pointer-events: none;
    animation: shapeDrop 0.3s ease-out;
  }

  @keyframes shapeDrop {
    from { transform: scale(0) rotate(180deg); opacity: 0; }
    to { transform: scale(1) rotate(0deg); opacity: 1; }
  }

  .shape-selector {
    display: flex;
    gap: 1rem;
    align-items: center;
  }

  .shape-btn {
    width: 40px;
    height: 40px;
    background: none;
    border: 2px solid var(--black);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
  }

  .shape-btn:hover, .shape-btn.active {
    background: var(--black);
  }

  .shape-btn:hover svg, .shape-btn.active svg { fill: var(--white); stroke: var(--white); }
  .shape-btn svg { width: 20px; height: 20px; fill: var(--black); stroke: var(--black); }

  .mixer-label {
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--dark-gray);
    min-width: 50px;
  }

  .btn-clear {
    background: none;
    border: 2px solid var(--black);
    padding: 0.4rem 1rem;
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    cursor: pointer;
    transition: background 0.2s, color 0.2s;
  }

  .btn-clear:hover { background: var(--black); color: var(--white); }

  /* ===== GEOMETRY PLAYGROUND ===== */
  #geometry {
    padding: 6rem 4rem;
    background: var(--blue);
    color: var(--white);
  }

  #geometry .section-header h2 { color: var(--white); }

  .geo-playground {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
    margin-top: 2rem;
  }

  .geo-card {
    aspect-ratio: 1;
    background: rgba(255,255,255,0.08);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1.5rem;
    cursor: pointer;
    transition: background 0.3s;
    position: relative;
  }

  .geo-card:hover { background: rgba(255,255,255,0.14); }

  .geo-card .geo-shape {
    transition: transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  .geo-card:hover .geo-shape { transform: rotate(180deg); }

  .geo-card .geo-shape.geo-circle {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 5px solid var(--white);
  }

  .geo-card .geo-shape.geo-triangle {
    width: 0;
    height: 0;
    border-left: 55px solid transparent;
    border-right: 55px solid transparent;
    border-bottom: 95px solid var(--yellow);
  }

  .geo-card .geo-shape.geo-square {
    width: 90px;
    height: 90px;
    background: var(--red);
  }

  .geo-card .geo-label {
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    opacity: 0.7;
  }

  .geo-card .geo-desc {
    font-size: 0.75rem;
    color: rgba(255,255,255,0.6);
    text-align: center;
    padding: 0 1rem;
    line-height: 1.5;
  }

  /* click ripple */
  .geo-card .ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(255,255,255,0.15);
    animation: rippleOut 0.6s ease-out forwards;
    pointer-events: none;
  }

  @keyframes rippleOut {
    from { width: 0; height: 0; opacity: 1; }
    to { width: 300px; height: 300px; opacity: 0; transform: translate(-50%, -50%); }
  }

  /* ===== TYPOGRAPHY SECTION ===== */
  #typography {
    padding: 6rem 4rem;
  }

  .typo-demo {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    align-items: start;
  }

  .typo-showcase {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .typo-sample {
    padding: 2rem;
    border-left: 4px solid var(--black);
    transition: border-color 0.3s;
  }

  .typo-sample:hover { border-color: var(--red); }

  .typo-sample .sample-text {
    font-size: clamp(1.5rem, 3vw, 2.5rem);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    line-height: 1.2;
  }

  .typo-sample .sample-meta {
    margin-top: 0.5rem;
    font-size: 0.65rem;
    color: var(--gray);
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .weight-slider-container {
    padding: 2rem;
    background: var(--black);
    color: var(--white);
  }

  .weight-slider-container label {
    display: block;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    margin-bottom: 0.75rem;
    color: var(--gray);
  }

  .weight-slider-container input[type="range"] {
    -webkit-appearance: none;
    width: 100%;
    height: 3px;
    background: var(--gray);
    outline: none;
  }

  .weight-slider-container input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 16px;
    height: 16px;
    background: var(--yellow);
    cursor: pointer;
  }

  .weight-preview {
    margin-top: 1.5rem;
    font-size: 2rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  /* ===== GRID DEMO ===== */
  #grid {
    padding: 6rem 4rem;
    background: var(--yellow);
  }

  #grid .section-header h2 { color: var(--black); }

  .grid-demo {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    grid-template-rows: repeat(6, 60px);
    gap: 4px;
    margin-top: 2rem;
  }

  .grid-block {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.6rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    cursor: pointer;
    transition: opacity 0.3s, transform 0.2s;
  }

  .grid-block:hover { opacity: 0.85; transform: scale(0.97); }

  .gb-1 { grid-column: 1 / 5; grid-row: 1 / 3; background: var(--red); color: var(--white); }
  .gb-2 { grid-column: 5 / 9; grid-row: 1 / 2; background: var(--black); color: var(--white); }
  .gb-3 { grid-column: 9 / 13; grid-row: 1 / 4; background: var(--blue); color: var(--white); }
  .gb-4 { grid-column: 5 / 9; grid-row: 2 / 4; background: var(--white); color: var(--black); }
  .gb-5 { grid-column: 1 / 5; grid-row: 3 / 5; background: var(--black); color: var(--yellow); }
  .gb-6 { grid-column: 5 / 7; grid-row: 4 / 6; background: var(--red); color: var(--white); }
  .gb-7 { grid-column: 7 / 13; grid-row: 4 / 5; background: var(--white); color: var(--black); }
  .gb-8 { grid-column: 1 / 5; grid-row: 5 / 7; background: var(--white); color: var(--black); }
  .gb-9 { grid-column: 7 / 10; grid-row: 5 / 7; background: var(--black); color: var(--white); }
  .gb-10 { grid-column: 10 / 13; grid-row: 5 / 7; background: var(--blue); color: var(--white); }
  .gb-11 { grid-column: 5 / 7; grid-row: 6 / 7; background: var(--yellow); color: var(--black); }

  .grid-text {
    margin-top: 3rem;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
  }

  .grid-text p {
    font-size: 0.9rem;
    line-height: 1.7;
    color: var(--dark-gray);
  }

  /* ===== MASTERS SECTION ===== */
  #masters {
    padding: 6rem 4rem;
  }

  .masters-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 2px;
  }

  .master-card {
    background: var(--black);
    color: var(--white);
    padding: 2.5rem 1.5rem;
    position: relative;
    overflow: hidden;
    transition: background 0.3s;
  }

  .master-card:hover { background: var(--dark-gray); }

  .master-card .master-initial {
    font-size: 4rem;
    font-weight: 700;
    line-height: 1;
    opacity: 0.15;
    position: absolute;
    top: 1rem;
    right: 1rem;
  }

  .master-card h4 {
    font-size: 0.85rem;
    margin-bottom: 0.25rem;
    letter-spacing: 0.1em;
  }

  .master-card .master-role {
    font-size: 0.65rem;
    color: var(--yellow);
    text-transform: uppercase;
    letter-spacing: 0.12em;
    margin-bottom: 1rem;
  }

  .master-card p {
    font-size: 0.78rem;
    color: var(--gray);
    line-height: 1.6;
  }

  /* ===== MANIFESTO ===== */
  #manifesto {
    padding: 6rem 4rem;
    background: var(--red);
    color: var(--white);
    text-align: center;
  }

  .manifesto-text {
    max-width: 700px;
    margin: 0 auto;
  }

  .manifesto-text h2 {
    font-size: clamp(2rem, 4vw, 3.5rem);
    margin-bottom: 2rem;
    line-height: 1.05;
  }

  .manifesto-text blockquote {
    font-size: 1.1rem;
    font-style: italic;
    line-height: 1.8;
    opacity: 0.9;
    border-left: 3px solid var(--white);
    padding-left: 1.5rem;
    text-align: left;
    margin: 2rem auto;
    max-width: 550px;
  }

  .manifesto-text blockquote footer {
    font-style: normal;
    font-size: 0.75rem;
    margin-top: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    opacity: 0.7;
  }

  /* ===== FOOTER ===== */
  footer.site-footer {
    background: var(--black);
    color: var(--gray);
    padding: 3rem 4rem;
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
  }

  footer.site-footer .footer-shapes {
    display: flex;
    gap: 1rem;
    align-items: center;
  }

  footer.site-footer .f-circle {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--yellow);
  }

  footer.site-footer .f-square {
    width: 18px;
    height: 18px;
    background: var(--red);
  }

  footer.site-footer .f-triangle {
    width: 0;
    height: 0;
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-bottom: 18px solid var(--blue);
  }

  footer.site-footer p {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  /* ===== SCROLL REVEAL ===== */
  .reveal {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.8s ease, transform 0.8s ease;
  }

  .reveal.visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 900px) {
    .hero { grid-template-columns: 1fr; }
    .hero-right { min-height: 50vh; }
    .hero-left { padding: 3rem 2rem; }
    #history { grid-template-columns: 1fr; padding: 4rem 2rem; }
    .principles-grid { grid-template-columns: 1fr 1fr; }
    .color-lab { grid-template-columns: 1fr; }
    .geo-playground { grid-template-columns: 1fr 1fr; }
    .typo-demo { grid-template-columns: 1fr; }
    .masters-grid { grid-template-columns: 1fr 1fr; }
    .grid-text { grid-template-columns: 1fr; }
    nav ul { display: none; }
    section { padding: 4rem 2rem !important; }
    footer.site-footer { grid-template-columns: 1fr; gap: 1rem; }
  }

  /* ===== EXPLORE 3D PORTAL ===== */
  #explore3d {
    padding: 6rem 4rem;
    background: var(--black);
    color: var(--white);
    position: relative;
    overflow: hidden;
    text-align: center;
  }

  #explore3d .section-header { justify-content: center; text-align: left; }

  .portal-desc {
    max-width: 600px;
    margin: 1.5rem auto 2.5rem;
    font-size: 0.95rem;
    color: var(--gray);
    line-height: 1.7;
  }

  .portal-btn {
    display: inline-block;
    padding: 1rem 2.5rem;
    background: var(--red);
    color: var(--white);
    border: none;
    font-family: inherit;
    font-size: 0.85rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    cursor: pointer;
    transition: background 0.3s, transform 0.2s;
  }

  .portal-btn:hover { background: #d4222f; transform: scale(1.05); }

  .portal-hint {
    margin-top: 1.5rem;
    font-size: 0.65rem;
    color: var(--gray);
    text-transform: uppercase;
    letter-spacing: 0.12em;
    opacity: 0.6;
  }

  .portal-mobile-msg {
    margin-top: 1.5rem;
    font-size: 0.85rem;
    color: var(--yellow);
  }

  .portal-geo {
    position: absolute;
    opacity: 0.06;
  }

  .portal-circle {
    width: 250px; height: 250px;
    border-radius: 50%;
    border: 40px solid var(--blue);
    top: -60px; right: 10%;
  }

  .portal-square {
    width: 150px; height: 150px;
    background: var(--red);
    bottom: -30px; left: 8%;
    transform: rotate(15deg);
  }

  .portal-tri {
    width: 0; height: 0;
    border-left: 80px solid transparent;
    border-right: 80px solid transparent;
    border-bottom: 140px solid var(--yellow);
    top: 30%; left: -20px;
  }

  /* ===== 3D OVERLAY ===== */
  .overlay3d {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 9999;
    background: #000;
    display: none;
  }

  .overlay3d.active { display: block; }

  .overlay3d.zoom-in {
    animation: overlayZoomIn 0.8s ease-out forwards;
  }

  .overlay3d.fade-out {
    animation: overlayFadeOut 0.5s ease-in forwards;
  }

  @keyframes overlayZoomIn {
    from { opacity: 0; transform: scale(1.3); }
    to { opacity: 1; transform: scale(1); }
  }

  @keyframes overlayFadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
  }

  #canvas3d {
    width: 100%; height: 100%;
    display: block;
  }

  .crosshair {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    color: rgba(255,255,255,0.6);
    font-size: 1.5rem;
    font-weight: 300;
    pointer-events: none;
    display: none;
    font-family: monospace;
    text-shadow: 0 0 4px rgba(0,0,0,0.5);
  }

  .crosshair.visible { display: block; }

  .instructions3d {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.7);
    color: var(--white);
    cursor: pointer;
  }

  .instructions3d h2 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    letter-spacing: 0.15em;
  }

  .instructions3d p {
    font-size: 1rem;
    opacity: 0.8;
  }

  .instructions-controls {
    margin-top: 1.5rem;
    font-size: 0.7rem !important;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    opacity: 0.5 !important;
  }

  .instructions3d.hidden { display: none; }

  .interact-prompt {
    position: absolute;
    bottom: 25%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.7);
    color: var(--yellow);
    padding: 0.6rem 1.5rem;
    font-size: 0.8rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    pointer-events: none;
    border: 1px solid var(--yellow);
  }

  .info-panel {
    position: absolute;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(26,26,26,0.95);
    color: var(--white);
    padding: 1.5rem 2rem;
    max-width: 500px;
    width: 90%;
    border-left: 4px solid var(--yellow);
  }

  .info-panel h3 {
    font-size: 0.9rem;
    letter-spacing: 0.1em;
    margin-bottom: 0.75rem;
    color: var(--yellow);
  }

  .info-panel p {
    font-size: 0.82rem;
    line-height: 1.7;
    color: var(--gray);
  }

  .info-panel-close {
    margin-top: 1rem;
    background: none;
    border: 1px solid var(--gray);
    color: var(--gray);
    padding: 0.3rem 1rem;
    font-family: inherit;
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    cursor: pointer;
    transition: color 0.2s, border-color 0.2s;
  }

  .info-panel-close:hover { color: var(--white); border-color: var(--white); }

  .exit-btn {
    position: absolute;
    top: 20px; right: 20px;
    background: rgba(26,26,26,0.8);
    color: var(--white);
    border: 1px solid var(--gray);
    padding: 0.5rem 1.2rem;
    font-family: inherit;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    cursor: pointer;
    z-index: 10;
    transition: background 0.2s;
  }

  .exit-btn:hover { background: var(--red); border-color: var(--red); }

  @media (max-width: 600px) {
    .principles-grid { grid-template-columns: 1fr; }
    .geo-playground { grid-template-columns: 1fr; }
    .masters-grid { grid-template-columns: 1fr; }
    .grid-demo {
      grid-template-columns: repeat(6, 1fr);
      grid-template-rows: repeat(8, 40px);
    }
    .gb-1 { grid-column: 1 / 4; grid-row: 1 / 3; }
    .gb-2 { grid-column: 4 / 7; grid-row: 1 / 2; }
    .gb-3 { grid-column: 4 / 7; grid-row: 2 / 4; }
    .gb-4 { grid-column: 1 / 4; grid-row: 3 / 5; }
    .gb-5 { grid-column: 4 / 7; grid-row: 4 / 6; }
    .gb-6 { grid-column: 1 / 3; grid-row: 5 / 7; }
    .gb-7 { grid-column: 3 / 7; grid-row: 6 / 7; }
    .gb-8 { grid-column: 1 / 4; grid-row: 7 / 9; }
    .gb-9 { grid-column: 4 / 6; grid-row: 7 / 9; }
    .gb-10 { grid-column: 6 / 7; grid-row: 7 / 9; }
    .gb-11 { grid-column: 1 / 3; grid-row: 5 / 6; }
  }
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="logo">Bau<span>haus</span></div>
  <ul>
    <li><a href="#history">History</a></li>
    <li><a href="#principles">Principles</a></li>
    <li><a href="#colors">Color</a></li>
    <li><a href="#geometry">Geometry</a></li>
    <li><a href="#typography">Type</a></li>
    <li><a href="#grid">Grid</a></li>
    <li><a href="#masters">Masters</a></li>
    <li><a href="#manifesto">Manifesto</a></li>
    <li><a href="#explore3d" style="color: var(--yellow);">Explore 3D</a></li>
  </ul>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="hero-left">
    <div class="hero-geo circle"></div>
    <div class="hero-geo triangle"></div>
    <h1>
      <span class="line-1">Form</span><br>
      <span class="line-2">Follows</span><br>
      <span class="line-3">Function</span>
    </h1>
    <p>The Bauhaus school (1919 &ndash; 1933) revolutionized art, architecture, and design by uniting craft and fine art under a philosophy of functional aesthetics.</p>
  </div>
  <div class="hero-right">
    <div class="hero-cell">
      <div class="shape circle-shape"></div>
      <span class="cell-label">Circle</span>
    </div>
    <div class="hero-cell">
      <div class="shape square-shape"></div>
      <span class="cell-label">Square</span>
    </div>
    <div class="hero-cell">
      <div class="shape triangle-shape"></div>
      <span class="cell-label">Triangle</span>
    </div>
    <div class="hero-cell">
      <div class="shape line-shape"></div>
      <span class="cell-label">Line</span>
    </div>
  </div>
</section>

<!-- HISTORY -->
<section id="history">
  <div class="text-col reveal">
    <div class="section-header">
      <span class="section-number">01</span>
      <div>
        <h2>Origin</h2>
        <div class="accent-bar" style="background: var(--red); width: 60px;"></div>
      </div>
    </div>
    <p>Founded in 1919 by architect Walter Gropius in Weimar, Germany, the Staatliches Bauhaus was a school that combined crafts and fine arts. Its name, derived from the German words for "building" (Bau) and "house" (Haus), reflected its mission to construct a new creative unity.</p>
    <p style="margin-top:1rem;">The school operated across three cities &mdash; Weimar (1919&ndash;1925), Dessau (1925&ndash;1932), and Berlin (1932&ndash;1933) &mdash; before being closed under pressure from the Nazi regime. Its influence, however, only grew after its closure, shaping modernist design across the globe.</p>
  </div>
  <div class="timeline reveal">
    <div class="timeline-item">
      <h4>1919 &mdash; Weimar</h4>
      <p>Walter Gropius founds the Bauhaus by merging the Weimar Academy of Fine Art and the School of Arts and Crafts. The initial manifesto calls for a return to craftsmanship and the unity of all arts.</p>
    </div>
    <div class="timeline-item">
      <h4>1923 &mdash; The Pivot</h4>
      <p>The school's motto shifts from expressionist ideals to "Art into Industry." The famous Haus Am Horn exhibition showcases Bauhaus principles in architecture and product design.</p>
    </div>
    <div class="timeline-item">
      <h4>1925 &mdash; Dessau</h4>
      <p>Political pressure forces the move to Dessau. Gropius designs the iconic Bauhaus building &mdash; itself a manifesto in glass, steel, and concrete. The school reaches its creative peak.</p>
    </div>
    <div class="timeline-item">
      <h4>1933 &mdash; Closure &amp; Legacy</h4>
      <p>Under Nazi pressure, Mies van der Rohe closes the school. Faculty emigrate worldwide, seeding Bauhaus thinking into the International Style and modern design education.</p>
    </div>
  </div>
</section>

<!-- PRINCIPLES -->
<section id="principles">
  <div class="section-header reveal">
    <span class="section-number" style="color: rgba(255,255,255,0.15);">02</span>
    <div>
      <h2>Core Principles</h2>
      <div class="accent-bar" style="background: var(--yellow); width: 60px;"></div>
    </div>
  </div>
  <div class="principles-grid">
    <div class="principle-card reveal">
      <div class="card-icon"><div class="icon-function"></div></div>
      <h3>Form Follows Function</h3>
      <p>Every design element must serve a purpose. Decoration without function is rejected. The shape of an object should emerge from its intended use, not from arbitrary stylistic choices.</p>
    </div>
    <div class="principle-card reveal">
      <div class="card-icon"><div class="icon-less"></div></div>
      <h3>Less Is More</h3>
      <p>Reduction to essentials. Strip away the unnecessary until only what matters remains. Simplicity is not emptiness &mdash; it is the most difficult and honest form of expression.</p>
    </div>
    <div class="principle-card reveal">
      <div class="card-icon"><div class="icon-unity"></div></div>
      <h3>Unity of Art &amp; Technology</h3>
      <p>Art cannot exist in isolation from industry. The Bauhaus sought to bridge the gap between the artist's vision and the engineer's precision, creating work that was both beautiful and reproducible.</p>
    </div>
    <div class="principle-card reveal">
      <div class="card-icon"><div class="icon-geometry"></div></div>
      <h3>Geometric Abstraction</h3>
      <p>Circle, triangle, square &mdash; the fundamental vocabulary. Complex forms are built from simple geometric primitives. This universal language transcends culture and communicates directly.</p>
    </div>
    <div class="principle-card reveal">
      <div class="card-icon"><div class="icon-typo">Aa</div></div>
      <h3>Functional Typography</h3>
      <p>Sans-serif typefaces. Clear hierarchy. Legibility above ornamentation. Herbert Bayer's Universal typeface eliminated uppercase letters entirely &mdash; a radical commitment to efficiency.</p>
    </div>
    <div class="principle-card reveal">
      <div class="card-icon"><div class="icon-grid"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div></div>
      <h3>Grid &amp; Structure</h3>
      <p>The underlying grid brings order to chaos. Asymmetric balance replaces classical symmetry. Every element is placed with mathematical intention, creating harmony through structure.</p>
    </div>
  </div>
</section>

<!-- COLOR LAB -->
<section id="colors">
  <div class="color-lab">
    <div class="text-col reveal">
      <div class="section-header">
        <span class="section-number">03</span>
        <div>
          <h2>Color Theory</h2>
          <div class="accent-bar" style="background: var(--blue); width: 60px;"></div>
        </div>
      </div>
      <p>The Bauhaus palette is built on the three primary colors &mdash; red, yellow, and blue &mdash; complemented by black, white, and gray. Johannes Itten and Josef Albers developed foundational color theory at the school, exploring contrast, interaction, and the psychological effects of color.</p>
      <p>Kandinsky assigned shapes to colors: yellow to the triangle (sharp, aggressive), blue to the circle (spiritual, calm), and red to the square (grounded, material). This correspondence between color and form became a core teaching principle.</p>
    </div>
    <div class="color-mixer reveal">
      <div class="mixer-row">
        <span class="mixer-label">Color</span>
        <div class="color-swatch active" data-color="red"></div>
        <div class="color-swatch" data-color="yellow"></div>
        <div class="color-swatch" data-color="blue"></div>
        <div class="color-swatch" data-color="black"></div>
        <div class="color-swatch" data-color="white"></div>
      </div>
      <div class="mixer-row">
        <span class="mixer-label">Shape</span>
        <div class="shape-selector">
          <button class="shape-btn active" data-shape="circle" title="Circle">
            <svg viewBox="0 0 20 20"><circle cx="10" cy="10" r="8" fill="none" stroke-width="2"/></svg>
          </button>
          <button class="shape-btn" data-shape="square" title="Square">
            <svg viewBox="0 0 20 20"><rect x="3" y="3" width="14" height="14" fill="none" stroke-width="2"/></svg>
          </button>
          <button class="shape-btn" data-shape="triangle" title="Triangle">
            <svg viewBox="0 0 20 20"><polygon points="10,2 18,18 2,18" fill="none" stroke-width="2"/></svg>
          </button>
          <button class="btn-clear" id="clearCanvas">Clear</button>
        </div>
      </div>
      <div class="canvas-preview" id="canvas"></div>
    </div>
  </div>
</section>

<!-- GEOMETRY -->
<section id="geometry">
  <div class="section-header reveal">
    <span class="section-number" style="color: rgba(255,255,255,0.15);">04</span>
    <div>
      <h2>Geometric Language</h2>
      <div class="accent-bar" style="background: var(--white); width: 60px;"></div>
    </div>
  </div>
  <div class="geo-playground">
    <div class="geo-card reveal">
      <div class="geo-shape geo-circle"></div>
      <span class="geo-label">Circle</span>
      <span class="geo-desc">Infinite, spiritual, cosmic. Blue. Kandinsky called it "the most peaceful shape" &mdash; without beginning or end.</span>
    </div>
    <div class="geo-card reveal">
      <div class="geo-shape geo-triangle"></div>
      <span class="geo-label">Triangle</span>
      <span class="geo-desc">Dynamic, aggressive, sharp. Yellow. The shape of action and directed energy, pointing toward a goal.</span>
    </div>
    <div class="geo-card reveal">
      <div class="geo-shape geo-square"></div>
      <span class="geo-label">Square</span>
      <span class="geo-desc">Stable, grounded, material. Red. The shape of stillness and certainty, rooted firmly in the physical world.</span>
    </div>
  </div>
</section>

<!-- TYPOGRAPHY -->
<section id="typography">
  <div class="section-header reveal">
    <span class="section-number">05</span>
    <div>
      <h2>Typography</h2>
      <div class="accent-bar" style="background: var(--red); width: 60px;"></div>
    </div>
  </div>
  <div class="typo-demo">
    <div class="typo-showcase reveal">
      <div class="typo-sample">
        <div class="sample-text">Universal</div>
        <div class="sample-meta">Geometric sans-serif &bull; Clean &bull; Functional</div>
      </div>
      <div class="typo-sample">
        <div class="sample-text" style="font-weight: 300; letter-spacing: 0.2em;">Hierarchy</div>
        <div class="sample-meta">Weight contrast creates visual order</div>
      </div>
      <div class="typo-sample">
        <div class="sample-text" style="font-size: clamp(0.8rem, 1.5vw, 1rem); letter-spacing: 0.3em;">Form before ornament</div>
        <div class="sample-meta">Readability is the highest priority</div>
      </div>
    </div>
    <div class="reveal">
      <div class="weight-slider-container">
        <label>Adjust weight &mdash; drag to explore</label>
        <input type="range" id="weightSlider" min="100" max="900" value="700" step="100">
        <div class="weight-preview" id="weightPreview">Bauhaus</div>
      </div>
      <div style="margin-top: 2rem;">
        <p style="font-size: 0.9rem; color: var(--dark-gray); line-height: 1.7;">Herbert Bayer's 1925 "Universal" typeface rejected uppercase letters entirely. He argued that since we don't speak in two alphabets, we shouldn't write in them either. This radical simplification embodied the Bauhaus commitment to stripping away everything unnecessary.</p>
        <p style="font-size: 0.9rem; color: var(--dark-gray); line-height: 1.7; margin-top: 1rem;">Bauhaus typography favors sans-serif faces, strong weight contrast for hierarchy, and asymmetric layouts driven by content rather than convention.</p>
      </div>
    </div>
  </div>
</section>

<!-- GRID -->
<section id="grid">
  <div class="section-header reveal">
    <span class="section-number">06</span>
    <div>
      <h2>The Grid</h2>
      <div class="accent-bar" style="background: var(--black); width: 60px;"></div>
    </div>
  </div>
  <div class="grid-demo reveal">
    <div class="grid-block gb-1">Structure</div>
    <div class="grid-block gb-2">Order</div>
    <div class="grid-block gb-3">Proportion</div>
    <div class="grid-block gb-4">Balance</div>
    <div class="grid-block gb-5">Asymmetry</div>
    <div class="grid-block gb-6">Rhythm</div>
    <div class="grid-block gb-7">Harmony</div>
    <div class="grid-block gb-8">Space</div>
    <div class="grid-block gb-9">Tension</div>
    <div class="grid-block gb-10">Unity</div>
    <div class="grid-block gb-11">Form</div>
  </div>
  <div class="grid-text reveal">
    <p>The grid is the skeleton of Bauhaus composition. Rather than centering elements symmetrically, Bauhaus designers used asymmetric grids to create dynamic tension and visual movement. Each block of content is placed with intention &mdash; nothing is arbitrary.</p>
    <p>This page itself is built on a grid system. Every section, every card, every element aligns to an underlying structure. The grid doesn't constrain creativity &mdash; it channels it, transforming chaos into deliberate, purposeful design.</p>
  </div>
</section>

<!-- EXPLORE 3D PORTAL -->
<section id="explore3d">
  <div class="portal-content reveal">
    <div class="portal-geo portal-circle"></div>
    <div class="portal-geo portal-square"></div>
    <div class="portal-geo portal-tri"></div>
    <div class="section-header">
      <span class="section-number" style="color: rgba(255,255,255,0.15);">3D</span>
      <div>
        <h2 style="color: var(--white);">Come Into the Bauhaus</h2>
        <div class="accent-bar" style="background: var(--red); width: 60px;"></div>
      </div>
    </div>
    <p class="portal-desc">Step inside the iconic Bauhaus Dessau building. Walk through the glass curtain wall workshops, cross the bridge between wings, and discover the spaces where modern design was born.</p>
    <button id="enterBauhaus" class="portal-btn">Enter the Building</button>
    <p class="portal-hint">WASD to move &bull; Mouse to look &bull; ESC to pause</p>
    <p class="portal-mobile-msg" style="display:none;">This 3D experience is available on desktop devices with a keyboard and mouse.</p>
  </div>
</section>

<!-- MASTERS -->
<section id="masters">
  <div class="section-header reveal">
    <span class="section-number">07</span>
    <div>
      <h2>The Masters</h2>
      <div class="accent-bar" style="background: var(--yellow); width: 60px;"></div>
    </div>
  </div>
  <div class="masters-grid">
    <div class="master-card reveal">
      <span class="master-initial">G</span>
      <h4>Walter Gropius</h4>
      <div class="master-role">Founder &amp; Director</div>
      <p>Architect and visionary who founded the Bauhaus in 1919 with a manifesto calling for the unity of all arts under architecture.</p>
    </div>
    <div class="master-card reveal">
      <span class="master-initial">K</span>
      <h4>Wassily Kandinsky</h4>
      <div class="master-role">Form Master</div>
      <p>Pioneer of abstract art who taught color theory and analytical drawing. His work on the correspondence of color and form became foundational.</p>
    </div>
    <div class="master-card reveal">
      <span class="master-initial">K</span>
      <h4>Paul Klee</h4>
      <div class="master-role">Form Master</div>
      <p>Painter and theorist whose notebooks on form and design remain among the most important texts in modern art education.</p>
    </div>
    <div class="master-card reveal">
      <span class="master-initial">M</span>
      <h4>Ludwig Mies van der Rohe</h4>
      <div class="master-role">Final Director</div>
      <p>"Less is more." The last director of the Bauhaus whose minimalist architecture defined the International Style and shaped skylines worldwide.</p>
    </div>
  </div>
</section>

<!-- MANIFESTO -->
<section id="manifesto">
  <div class="manifesto-text reveal">
    <h2>The Ultimate Aim of All Creative Activity Is the Building</h2>
    <blockquote>
      "Architects, painters, and sculptors must recognize anew and learn to grasp the composite character of a building both as an entity and in its separate parts. Only then will their work be imbued with the architectonic spirit."
      <footer>&mdash; Walter Gropius, Bauhaus Manifesto, 1919</footer>
    </blockquote>
  </div>
</section>

<!-- FOOTER -->
<footer class="site-footer">
  <p>Bauhaus &bull; 1919&ndash;1933 &bull; Weimar &middot; Dessau &middot; Berlin</p>
  <div class="footer-shapes">
    <div class="f-circle"></div>
    <div class="f-square"></div>
    <div class="f-triangle"></div>
  </div>
</footer>

<!-- 3D OVERLAY (hidden by default) -->
<div id="overlay3d" class="overlay3d">
  <canvas id="canvas3d"></canvas>
  <div id="crosshair" class="crosshair">+</div>
  <div id="instructions3d" class="instructions3d">
    <h2>Bauhaus Dessau</h2>
    <p>Click to begin exploring</p>
    <p class="instructions-controls">WASD &mdash; Move &nbsp;|&nbsp; Mouse &mdash; Look &nbsp;|&nbsp; E &mdash; Interact &nbsp;|&nbsp; ESC &mdash; Pause</p>
  </div>
  <div id="interactPrompt" class="interact-prompt" style="display:none;">Press E to read</div>
  <div id="infoPanel" class="info-panel" style="display:none;">
    <h3 id="infoPanelTitle"></h3>
    <p id="infoPanelText"></p>
    <button id="infoPanelClose" class="info-panel-close">Close</button>
  </div>
  <button id="exitBtn" class="exit-btn" style="display:none;">Return to Site</button>
</div>

<script>
(function() {
  // ===== SCROLL REVEAL =====
  const reveals = document.querySelectorAll('.reveal');
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
      }
    });
  }, { threshold: 0.1, rootMargin: '0px 0px -40px 0px' });

  reveals.forEach(el => observer.observe(el));

  // ===== COLOR MIXER / CANVAS =====
  let selectedColor = 'red';
  let selectedShape = 'circle';
  const colorMap = {
    red: '#BE1E2D',
    yellow: '#F2C12E',
    blue: '#1B3DA6',
    black: '#1A1A1A',
    white: '#F5F1EB'
  };

  document.querySelectorAll('.color-swatch').forEach(swatch => {
    swatch.addEventListener('click', function() {
      document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
      this.classList.add('active');
      selectedColor = this.dataset.color;
    });
  });

  document.querySelectorAll('.shape-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.shape-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      selectedShape = this.dataset.shape;
    });
  });

  const canvas = document.getElementById('canvas');
  canvas.addEventListener('click', function(e) {
    const rect = this.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    const color = colorMap[selectedColor];
    const size = 20 + Math.random() * 30;

    const el = document.createElement('div');
    el.classList.add('placed-shape');

    if (selectedShape === 'circle') {
      el.style.cssText = `width:${size}px;height:${size}px;border-radius:50%;background:${color};left:${x - size/2}px;top:${y - size/2}px;`;
    } else if (selectedShape === 'square') {
      el.style.cssText = `width:${size}px;height:${size}px;background:${color};left:${x - size/2}px;top:${y - size/2}px;transform:rotate(${Math.random()*45}deg);`;
    } else {
      const half = size / 2;
      el.style.cssText = `width:0;height:0;border-left:${half}px solid transparent;border-right:${half}px solid transparent;border-bottom:${size}px solid ${color};left:${x - half}px;top:${y - size/2}px;`;
    }

    this.appendChild(el);
  });

  document.getElementById('clearCanvas').addEventListener('click', function() {
    canvas.querySelectorAll('.placed-shape').forEach(s => s.remove());
  });

  // ===== WEIGHT SLIDER =====
  const slider = document.getElementById('weightSlider');
  const preview = document.getElementById('weightPreview');
  slider.addEventListener('input', function() {
    preview.style.fontWeight = this.value;
  });

  // ===== GEOMETRY CLICK RIPPLE =====
  document.querySelectorAll('.geo-card').forEach(card => {
    card.addEventListener('click', function(e) {
      const rect = this.getBoundingClientRect();
      const ripple = document.createElement('div');
      ripple.classList.add('ripple');
      ripple.style.left = (e.clientX - rect.left) + 'px';
      ripple.style.top = (e.clientY - rect.top) + 'px';
      this.appendChild(ripple);
      setTimeout(() => ripple.remove(), 600);
    });
  });

  // ===== GRID BLOCK SHUFFLE =====
  document.querySelectorAll('.grid-block').forEach(block => {
    block.addEventListener('click', function() {
      this.style.transition = 'transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)';
      this.style.transform = 'scale(0.92)';
      setTimeout(() => { this.style.transform = 'scale(1)'; }, 200);
    });
  });

  // ===== SMOOTH NAV HIGHLIGHT =====
  const sections = document.querySelectorAll('section[id]');
  const navLinks = document.querySelectorAll('nav ul li a');

  window.addEventListener('scroll', () => {
    let current = '';
    sections.forEach(section => {
      const top = section.offsetTop - 100;
      if (scrollY >= top) current = section.getAttribute('id');
    });
    navLinks.forEach(link => {
      link.style.color = '';
      if (link.getAttribute('href') === '#' + current) {
        link.style.color = '#F5F1EB';
      }
    });
  });
})();
</script>

<script type="module">
// ===== 3D BAUHAUS EXPERIENCE =====
import * as THREE from 'three';
import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

(function() {
  // ===== MOBILE DETECTION =====
  const isMobile = /Android|iPhone|iPad|iPod|webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || ('ontouchstart' in window && window.innerWidth < 1024);
  if (isMobile) {
    const btn = document.getElementById('enterBauhaus');
    const hint = document.querySelector('.portal-hint');
    const msg = document.querySelector('.portal-mobile-msg');
    if (btn) btn.style.display = 'none';
    if (hint) hint.style.display = 'none';
    if (msg) msg.style.display = 'block';
    return;
  }

  // ===== STATE =====
  let scene, camera, renderer, controls;
  let initialized = false;
  let running = false;
  let scrollPos = 0;
  const moveState = { forward: false, backward: false, left: false, right: false };
  const velocity = new THREE.Vector3();
  const direction = new THREE.Vector3();
  const clock = new THREE.Clock();
  const SPEED = 8;
  const PLAYER_HEIGHT = 1.7;
  const PLAYER_RADIUS = 0.4;
  let collisionMeshes = [];
  let floorMeshes = [];
  let hotspots = [];
  let activeHotspot = null;
  let infoPanelOpen = false;
  let hotspotMarkers = [];

  // ===== DOM REFS =====
  const overlay = document.getElementById('overlay3d');
  const canvas3d = document.getElementById('canvas3d');
  const instructions = document.getElementById('instructions3d');
  const crosshair = document.getElementById('crosshair');
  const interactPrompt = document.getElementById('interactPrompt');
  const infoPanel = document.getElementById('infoPanel');
  const infoPanelTitle = document.getElementById('infoPanelTitle');
  const infoPanelText = document.getElementById('infoPanelText');
  const infoPanelClose = document.getElementById('infoPanelClose');
  const exitBtn = document.getElementById('exitBtn');
  const enterBtn = document.getElementById('enterBauhaus');

  // ===== COLORS =====
  const C = {
    wall: 0xE8E4DC,
    glass: 0x8BACCC,
    floor: 0x999490,
    floorInterior: 0xC8C2B8,
    column: 0x3A3A3A,
    red: 0xBE1E2D,
    yellow: 0xF2C12E,
    blue: 0x1B3DA6,
    black: 0x1A1A1A,
    white: 0xF5F1EB,
    ground: 0x7A8B5C,
    sky: 0x87CEEB,
  };

  // ===== HOTSPOT DATA =====
  const hotspotData = [
    { pos: [0, 1.5, 18], title: 'The Entrance', text: 'Welcome to the Bauhaus Dessau, designed by Walter Gropius and completed in 1926. This building is itself a manifesto \u2014 its pinwheel plan, flat roofs, glass curtain walls, and absence of ornament embody every principle the school taught. It was designated a UNESCO World Heritage Site in 1996.' },
    { pos: [-14, 1.5, 6], title: 'The Glass Curtain Wall', text: 'The workshop wing\'s floor-to-ceiling glass facade was revolutionary in 1926. Suspended from the building\'s frame rather than bearing any load, this "curtain wall" dissolved the boundary between inside and outside, flooding the workshops with natural light. It became one of the most influential architectural details of the 20th century.' },
    { pos: [5, 1.5, 5], title: 'The Workshops', text: 'Here students learned by doing \u2014 weaving, metalwork, carpentry, pottery, and printing. The Bauhaus rejected the distinction between "fine" and "applied" art. Every student took the Vorkurs (preliminary course) before choosing a workshop, ensuring a foundation in color, form, and materials.' },
    { pos: [0, 5, 0], title: 'The Bridge', text: 'This elevated corridor connected the workshop wing to the technical school, symbolizing the Bauhaus mission to bridge art and technology. Administrative offices and Gropius\'s own studio were located here, literally overseeing both halves of the school.' },
    { pos: [18, 1.5, -2], title: 'The Canteen & Stage', text: 'The canteen and auditorium were the social heart of the Bauhaus. Oskar Schlemmer\'s Triadic Ballet premiered on this stage \u2014 dancers in geometric costumes exploring the relationship between the human body and abstract form. The famous Bauhaus parties were legendary events.' },
    { pos: [0, 5, -14], title: 'A Student Studio', text: 'The Prellerhaus contained 28 studio apartments for students. Each compact unit featured furniture designed by Marcel Breuer, including his iconic Wassily Chair made from bent steel tubing. The balconies gave each studio access to light and air \u2014 essentials of modern living.' },
    { pos: [8, 1.5, 6], title: 'The Classroom', text: 'In these rooms, Wassily Kandinsky taught analytical drawing and color theory, Paul Klee explored the theory of form, and Josef Albers led the Vorkurs. The pedagogical notebooks of these masters remain foundational texts in design education worldwide.' },
    { pos: [-8, 1.5, -5], title: 'The Color Scheme', text: 'Hinnerk Scheper, master of the wall-painting workshop, designed the building\'s interior color scheme. Different rooms used different palettes \u2014 warm yellows for social spaces, cool blues for studios, and primary color accents on structural elements. Color was treated as an architectural material.' },
  ];

  // ===== INIT SCENE =====
  function initScene() {
    if (initialized) return;
    initialized = true;

    scene = new THREE.Scene();
    scene.background = new THREE.Color(C.sky);
    scene.fog = new THREE.Fog(C.sky, 60, 120);

    camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 200);
    camera.position.set(0, PLAYER_HEIGHT, 22);

    renderer = new THREE.WebGLRenderer({ canvas: canvas3d, antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.2;

    controls = new PointerLockControls(camera, overlay);

    // ===== LIGHTING =====
    const ambient = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambient);

    const hemi = new THREE.HemisphereLight(0x87CEEB, 0x556B2F, 0.4);
    scene.add(hemi);

    const sun = new THREE.DirectionalLight(0xffffff, 1.2);
    sun.position.set(20, 30, 15);
    sun.castShadow = true;
    sun.shadow.mapSize.width = 2048;
    sun.shadow.mapSize.height = 2048;
    sun.shadow.camera.left = -50;
    sun.shadow.camera.right = 50;
    sun.shadow.camera.top = 50;
    sun.shadow.camera.bottom = -50;
    sun.shadow.camera.near = 0.5;
    sun.shadow.camera.far = 100;
    scene.add(sun);

    buildGround();
    buildBauhaus();
    buildFurniture();
    buildHotspots();
    setupControls();
  }

  // ===== MATERIALS =====
  function mat(color, opts = {}) {
    return new THREE.MeshStandardMaterial({ color, roughness: opts.roughness ?? 0.85, metalness: opts.metalness ?? 0.05, ...opts });
  }

  function glassMat() {
    return new THREE.MeshPhysicalMaterial({
      color: C.glass,
      transparent: true,
      opacity: 0.3,
      roughness: 0.05,
      metalness: 0.1,
      transmission: 0.6,
      side: THREE.DoubleSide,
    });
  }

  // ===== HELPERS =====
  function box(w, h, d, material, x, y, z, collision = true) {
    const geo = new THREE.BoxGeometry(w, h, d);
    const mesh = new THREE.Mesh(geo, material);
    mesh.position.set(x, y, z);
    mesh.castShadow = true;
    mesh.receiveShadow = true;
    scene.add(mesh);
    if (collision) collisionMeshes.push(mesh);
    return mesh;
  }

  function floor(w, d, material, x, y, z) {
    const geo = new THREE.BoxGeometry(w, 0.15, d);
    const mesh = new THREE.Mesh(geo, material);
    mesh.position.set(x, y, z);
    mesh.receiveShadow = true;
    scene.add(mesh);
    floorMeshes.push(mesh);
    return mesh;
  }

  // ===== GROUND =====
  function buildGround() {
    const groundGeo = new THREE.PlaneGeometry(200, 200);
    const groundMat = mat(C.ground, { roughness: 1.0 });
    const ground = new THREE.Mesh(groundGeo, groundMat);
    ground.rotation.x = -Math.PI / 2;
    ground.position.y = -0.01;
    ground.receiveShadow = true;
    scene.add(ground);
    floorMeshes.push(ground);

    // Paved area around building
    const pavedGeo = new THREE.PlaneGeometry(80, 60);
    const pavedMat = mat(0xB0ACA0, { roughness: 0.95 });
    const paved = new THREE.Mesh(pavedGeo, pavedMat);
    paved.rotation.x = -Math.PI / 2;
    paved.position.y = 0.01;
    paved.receiveShadow = true;
    scene.add(paved);
  }

  // ===== BUILD BAUHAUS DESSAU =====
  function buildBauhaus() {
    const wallMat = mat(C.wall);
    const floorMat = mat(C.floorInterior);
    const columnMat = mat(C.column, { roughness: 0.6, metalness: 0.2 });
    const glassMaterial = glassMat();
    const redMat = mat(C.red);
    const yellowMat = mat(C.yellow);
    const blueMat = mat(C.blue);
    const darkMat = mat(C.black);
    const frameMat = mat(0x555555, { metalness: 0.3 });

    // === WORKSHOP WING (south, left side) ===
    // 30 wide (x), 12 deep (z), 15 tall (y), 3 floors at 5m each
    const wsX = -7, wsZ = 3;

    // Back wall (north face of workshop)
    box(0.3, 15, 12, wallMat, wsX + 15, 7.5, wsZ, true);
    // Lower wall sections (below glass curtain wall on south, solid on north with door gap)
    box(30, 2, 0.3, wallMat, wsX, 1, wsZ - 6, true);
    // North lower wall - split for door at wsX+2 (= -5), gap width 3
    wallWithDoorX(wsX, wsZ + 6, 30, 2, 0.3, wsX + 2, 3, 2, wallMat);

    // Floors
    for (let f = 0; f < 3; f++) {
      floor(30, 12, floorMat, wsX, f * 5, wsZ);
    }
    // Roof
    floor(30, 12, wallMat, wsX, 15, wsZ);

    // Glass curtain wall - south and west facades
    // South face glass panels (z = wsZ - 6)
    for (let f = 0; f < 3; f++) {
      for (let i = 0; i < 10; i++) {
        const gp = box(2.8, 4.5, 0.08, glassMaterial, wsX - 13.5 + i * 3, f * 5 + 2.75, wsZ - 6, false);
        gp.castShadow = false;
        // Glass frame mullions
        box(0.08, 4.5, 0.12, frameMat, wsX - 12 + i * 3, f * 5 + 2.75, wsZ - 6, false);
      }
      // Horizontal spandrel between floors
      if (f < 2) box(30, 0.5, 0.15, frameMat, wsX, (f + 1) * 5, wsZ - 6, false);
    }

    // West face glass panels (x = wsX - 15)
    for (let f = 0; f < 3; f++) {
      for (let i = 0; i < 4; i++) {
        const gp = box(0.08, 4.5, 2.8, glassMaterial, wsX - 15, f * 5 + 2.75, wsZ - 4.5 + i * 3, false);
        gp.castShadow = false;
        box(0.12, 4.5, 0.08, frameMat, wsX - 15, f * 5 + 2.75, wsZ - 3 + i * 3, false);
      }
      if (f < 2) box(0.15, 0.5, 12, frameMat, wsX - 15, (f + 1) * 5, wsZ, false);
    }

    // North face with door opening (wsX=-7, so wall center at -7, door at wsX+2=-5)
    wallWithDoorX(wsX, wsZ + 6, 30, 15, 0.3, wsX + 2, 3, 3.5, wallMat);
    // Door surround visual
    box(3.2, 0.2, 0.35, darkMat, wsX + 2, 3.5, wsZ + 6, false); // lintel accent
    box(0.15, 3.5, 0.35, darkMat, wsX + 0.5, 1.75, wsZ + 6, false); // left jamb
    box(0.15, 3.5, 0.35, darkMat, wsX + 3.5, 1.75, wsZ + 6, false); // right jamb

    // Structural columns inside workshop
    for (let cx = -18; cx <= 6; cx += 6) {
      for (let cz = -3; cz <= 3; cz += 6) {
        const col = new THREE.Mesh(
          new THREE.CylinderGeometry(0.2, 0.2, 15, 8),
          columnMat
        );
        col.position.set(cx, 7.5, wsZ + cz);
        col.castShadow = true;
        scene.add(col);
      }
    }

    // Interior point light for workshop
    const wsLight = new THREE.PointLight(0xFFF5E0, 0.8, 20);
    wsLight.position.set(wsX, 4, wsZ);
    scene.add(wsLight);

    // === BRIDGE (center, elevated) ===
    // 12 wide (x), 6 deep (z), connects at 2nd floor level
    const brY = 5;
    // Bridge floor
    floor(12, 6, floorMat, 0, brY, 0);
    // Bridge ceiling/roof
    floor(12, 6, wallMat, 0, brY + 4, 0);
    // Bridge walls (east and west with windows)
    box(12, 4, 0.3, wallMat, 0, brY + 2, -3, true);
    box(12, 4, 0.3, wallMat, 0, brY + 2, 3, true);
    // Bridge windows
    for (let i = 0; i < 4; i++) {
      box(2, 2, 0.1, glassMaterial, -4.5 + i * 3, brY + 2.5, -3, false);
      box(2, 2, 0.1, glassMaterial, -4.5 + i * 3, brY + 2.5, 3, false);
    }
    // Support columns for bridge
    for (let bx = -4; bx <= 4; bx += 8) {
      const bcol = new THREE.Mesh(new THREE.CylinderGeometry(0.25, 0.25, brY, 8), columnMat);
      bcol.position.set(bx, brY / 2, 0);
      bcol.castShadow = true;
      scene.add(bcol);
      collisionMeshes.push(bcol);
    }

    // === NORTH WING (north side) ===
    // 25 wide (x), 12 deep (z), 15 tall, solid facades
    const nwX = 4, nwZ = -9;

    // Walls
    box(0.3, 15, 12, wallMat, nwX - 12.5, 7.5, nwZ, true); // west wall
    box(0.3, 15, 12, wallMat, nwX + 12.5, 7.5, nwZ, true); // east wall
    box(25, 15, 0.3, wallMat, nwX, 7.5, nwZ - 6, true); // north wall
    // South wall with door opening (nwX=4, door centered at nwX=4)
    wallWithDoorX(nwX, nwZ + 6, 25, 15, 0.3, nwX, 3, 3.5, wallMat);

    // Floors
    for (let f = 0; f < 3; f++) {
      floor(25, 12, floorMat, nwX, f * 5, nwZ);
    }
    floor(25, 12, wallMat, nwX, 15, nwZ); // roof

    // Windows on north facade
    for (let f = 0; f < 3; f++) {
      for (let i = 0; i < 6; i++) {
        box(2.5, 3, 0.1, glassMaterial, nwX - 10 + i * 4, f * 5 + 2, nwZ - 6, false);
      }
    }

    // Interior light
    const nwLight = new THREE.PointLight(0xFFF5E0, 0.6, 18);
    nwLight.position.set(nwX, 4, nwZ);
    scene.add(nwLight);

    // Interior divider walls (classrooms)
    box(0.2, 5, 12, wallMat, nwX - 4, 2.5, nwZ, true);
    box(0.2, 5, 12, wallMat, nwX + 4, 2.5, nwZ, true);

    // Accent wall
    box(0.05, 5, 4, redMat, nwX - 4.1, 2.5, nwZ - 2, false);

    // === LOW-RISE CONNECTOR (east, canteen/auditorium) ===
    const lrX = 18, lrZ = -2;
    // West wall with door (lrX-5 = 13, door at center lrZ=-2)
    wallWithDoorZ(lrX - 5, lrZ, 0.3, 5, 10, lrZ, 3, 3.5, wallMat);
    box(0.3, 5, 10, wallMat, lrX + 5, 2.5, lrZ, true);
    box(10, 5, 0.3, wallMat, lrX, 2.5, lrZ - 5, true);
    box(10, 5, 0.3, wallMat, lrX, 2.5, lrZ + 5, true);
    floor(10, 10, floorMat, lrX, 0, lrZ);
    floor(10, 10, wallMat, lrX, 5, lrZ); // roof

    // Large windows
    for (let i = 0; i < 3; i++) {
      box(2.5, 3.5, 0.1, glassMaterial, lrX, 2.25, lrZ - 5 + i * 3, false);
    }

    const lrLight = new THREE.PointLight(0xFFF5E0, 0.5, 15);
    lrLight.position.set(lrX, 3.5, lrZ);
    scene.add(lrLight);

    // Yellow accent wall inside canteen
    box(0.05, 5, 5, yellowMat, lrX + 4.9, 2.5, lrZ, false);

    // === STUDIO BUILDING (Prellerhaus, south-back) ===
    const stX = 0, stZ = -18;
    box(12, 20, 0.3, wallMat, stX, 10, stZ - 6, true); // north
    // South wall with door opening (stX=0, door at center)
    wallWithDoorX(stX, stZ + 6, 12, 20, 0.3, stX, 3, 3.5, wallMat);
    box(0.3, 20, 12, wallMat, stX - 6, 10, stZ, true); // west
    box(0.3, 20, 12, wallMat, stX + 6, 10, stZ, true); // east

    for (let f = 0; f < 4; f++) {
      floor(12, 12, floorMat, stX, f * 5, stZ);
    }
    floor(12, 12, wallMat, stX, 20, stZ); // roof

    // Balconies on south face
    for (let f = 1; f < 4; f++) {
      for (let b = -3; b <= 3; b += 6) {
        const balcony = box(5, 0.15, 1.5, wallMat, stX + b, f * 5, stZ + 6.75, false);
        // Balcony railing
        box(5, 0.8, 0.08, frameMat, stX + b, f * 5 + 0.5, stZ + 7.4, false);
      }
    }

    // Windows on east face
    for (let f = 0; f < 4; f++) {
      for (let i = 0; i < 3; i++) {
        box(0.1, 3, 2.5, glassMaterial, stX + 6, f * 5 + 2, stZ - 4 + i * 4, false);
      }
    }

    const stLight = new THREE.PointLight(0xFFF5E0, 0.5, 15);
    stLight.position.set(stX, 4, stZ);
    scene.add(stLight);

    // Blue accent wall inside studio
    box(6, 5, 0.05, blueMat, stX, 2.5, stZ - 5.9, false);

    // === RAMP from ground to bridge (2nd floor access) ===
    buildRamp(-6, 0, 3, -6, 5, -1, wallMat);
    // Ramp from bridge level to 2nd floor of north wing
    buildRamp(6, 5, -1, 6, 5, -5, wallMat);

    // === BAUHAUS LETTERING on Workshop south facade ===
    buildBauhausSign(wsX - 15.1, 10, wsZ);

    // Door openings are now built directly into the walls above
  }

  function buildRamp(x1, y1, z1, x2, y2, z2, material) {
    const dx = x2 - x1, dy = y2 - y1, dz = z2 - z1;
    const length = Math.sqrt(dx * dx + dy * dy + dz * dz);
    const angle = Math.atan2(dy, Math.sqrt(dx * dx + dz * dz));
    const yaw = Math.atan2(dx, dz);

    const rampGeo = new THREE.BoxGeometry(2.5, 0.15, length);
    const ramp = new THREE.Mesh(rampGeo, material);
    ramp.position.set((x1 + x2) / 2, (y1 + y2) / 2, (z1 + z2) / 2);
    ramp.rotation.x = -angle;
    ramp.rotation.y = yaw;
    ramp.receiveShadow = true;
    scene.add(ramp);
    floorMeshes.push(ramp);

    // Ramp railings
    const railMat = mat(C.column, { metalness: 0.3 });
    for (const side of [-1, 1]) {
      const rail = new THREE.Mesh(new THREE.BoxGeometry(0.08, 1, length), railMat);
      rail.position.copy(ramp.position);
      rail.position.y += 0.5;
      rail.position.x += side * 1.2;
      rail.rotation.copy(ramp.rotation);
      scene.add(rail);
    }
  }

  // Build a wall along X-axis with a door gap in it
  // wallCenterX, wallCenterZ: center of the full wall
  // wallWidth: total wall width (along X)
  // wallHeight: wall height
  // wallDepth: wall thickness (along Z)
  // doorX: center X of door opening (absolute)
  // doorW: width of door opening
  // doorH: height of door opening
  function wallWithDoorX(wallCenterX, wallCenterZ, wallWidth, wallHeight, wallDepth, doorX, doorW, doorH, material) {
    const wallLeft = wallCenterX - wallWidth / 2;
    const wallRight = wallCenterX + wallWidth / 2;
    const doorLeft = doorX - doorW / 2;
    const doorRight = doorX + doorW / 2;

    // Left segment
    const leftW = doorLeft - wallLeft;
    if (leftW > 0.1) {
      box(leftW, wallHeight, wallDepth, material, wallLeft + leftW / 2, wallHeight / 2, wallCenterZ, true);
    }
    // Right segment
    const rightW = wallRight - doorRight;
    if (rightW > 0.1) {
      box(rightW, wallHeight, wallDepth, material, doorRight + rightW / 2, wallHeight / 2, wallCenterZ, true);
    }
    // Lintel above door
    const lintelH = wallHeight - doorH;
    if (lintelH > 0.1) {
      box(doorW, lintelH, wallDepth, material, doorX, doorH + lintelH / 2, wallCenterZ, true);
    }
  }

  // Build a wall along Z-axis with a door gap in it
  function wallWithDoorZ(wallCenterX, wallCenterZ, wallDepth_x, wallHeight, wallWidth_z, doorZ, doorW, doorH, material) {
    const wallFront = wallCenterZ - wallWidth_z / 2;
    const wallBack = wallCenterZ + wallWidth_z / 2;
    const doorFront = doorZ - doorW / 2;
    const doorBack = doorZ + doorW / 2;

    // Front segment
    const frontW = doorFront - wallFront;
    if (frontW > 0.1) {
      box(wallDepth_x, wallHeight, frontW, material, wallCenterX, wallHeight / 2, wallFront + frontW / 2, true);
    }
    // Back segment
    const backW = wallBack - doorBack;
    if (backW > 0.1) {
      box(wallDepth_x, wallHeight, backW, material, wallCenterX, wallHeight / 2, doorBack + backW / 2, true);
    }
    // Lintel above door
    const lintelH = wallHeight - doorH;
    if (lintelH > 0.1) {
      box(wallDepth_x, lintelH, doorW, material, wallCenterX, doorH + lintelH / 2, doorZ, true);
    }
  }

  function buildBauhausSign(x, y, z) {
    const canvas2d = document.createElement('canvas');
    canvas2d.width = 128;
    canvas2d.height = 512;
    const ctx = canvas2d.getContext('2d');
    ctx.fillStyle = '#E8E4DC';
    ctx.fillRect(0, 0, 128, 512);
    ctx.fillStyle = '#1A1A1A';
    ctx.font = 'bold 64px Helvetica, Arial, sans-serif';
    ctx.textAlign = 'center';
    const letters = 'BAUHAUS';
    for (let i = 0; i < letters.length; i++) {
      ctx.fillText(letters[i], 64, 70 + i * 65);
    }

    const texture = new THREE.CanvasTexture(canvas2d);
    const signGeo = new THREE.PlaneGeometry(2, 8);
    const signMat = new THREE.MeshStandardMaterial({ map: texture, roughness: 0.8 });
    const sign = new THREE.Mesh(signGeo, signMat);
    sign.position.set(x, y, z);
    sign.rotation.y = Math.PI / 2;
    scene.add(sign);
  }

  // ===== FURNITURE =====
  function buildFurniture() {
    const metalMat = mat(0x888888, { metalness: 0.5, roughness: 0.4 });
    const blackLeather = mat(C.black, { roughness: 0.7 });
    const woodMat = mat(0xA0845C, { roughness: 0.8 });

    // Workshop area: work tables + easels
    for (let i = 0; i < 4; i++) {
      buildTable(-10 + i * 5, 0, 3, woodMat, metalMat);
    }

    // Classroom: desks + blackboard
    buildBlackboard(8, 0, -12);
    for (let r = 0; r < 2; r++) {
      for (let c = 0; c < 3; c++) {
        buildTable(2 + c * 4, 0, -7 - r * 3, woodMat, metalMat);
      }
    }

    // Wassily chairs in studio building
    for (let i = 0; i < 3; i++) {
      buildWassilyChair(-2 + i * 2, 0, -18, metalMat, blackLeather);
    }

    // Wall art frames
    buildWallArt(-6, 2.5, 5.7, C.red, 'square');
    buildWallArt(-2, 2.5, 5.7, C.blue, 'circle');
    buildWallArt(2, 2.5, 5.7, C.yellow, 'triangle');

    // Bauhaus lamps
    buildLamp(-10, 0, 1);
    buildLamp(5, 0, 1);
    buildLamp(0, 0, -18);
    buildLamp(18, 0, -2);

    // Geometric sculptures on pedestals
    buildSculpture(-3, 0, 8, 'sphere', C.blue);
    buildSculpture(3, 0, 8, 'cube', C.red);
    buildSculpture(0, 0, 10, 'cone', C.yellow);
  }

  function buildTable(x, y, z, topMat, legMat) {
    box(1.8, 0.08, 1, topMat, x, y + 0.75, z, false);
    const legGeo = new THREE.CylinderGeometry(0.04, 0.04, 0.75, 6);
    for (const [lx, lz] of [[-0.7, -0.35], [0.7, -0.35], [-0.7, 0.35], [0.7, 0.35]]) {
      const leg = new THREE.Mesh(legGeo, legMat);
      leg.position.set(x + lx, y + 0.375, z + lz);
      scene.add(leg);
    }
  }

  function buildWassilyChair(x, y, z, frameMat, seatMat) {
    // Simplified Wassily chair: tubular frame + seat/back panels
    const tubeGeo = new THREE.CylinderGeometry(0.02, 0.02, 0.65, 6);
    // Legs
    for (const [lx, lz] of [[-0.3, -0.3], [0.3, -0.3], [-0.3, 0.3], [0.3, 0.3]]) {
      const leg = new THREE.Mesh(tubeGeo, frameMat);
      leg.position.set(x + lx, y + 0.325, z + lz);
      scene.add(leg);
    }
    // Seat
    box(0.6, 0.03, 0.6, seatMat, x, y + 0.4, z, false);
    // Back
    box(0.6, 0.4, 0.03, seatMat, x, y + 0.6, z - 0.3, false);
    // Armrests
    for (const side of [-0.3, 0.3]) {
      box(0.03, 0.03, 0.6, frameMat, x + side, y + 0.55, z, false);
    }
  }

  function buildBlackboard(x, y, z) {
    box(3, 2, 0.1, mat(0x2A3A2A), x, y + 1.5, z, false); // board
    box(3.2, 0.1, 0.15, mat(0x8B7355), x, y + 0.48, z, false); // chalk tray
  }

  function buildWallArt(x, y, z, color, shape) {
    // Frame
    box(1.2, 1.2, 0.05, mat(C.black), x, y, z, false);
    // White background
    box(1.0, 1.0, 0.06, mat(C.white), x, y, z, false);

    const artMat = mat(color);
    if (shape === 'circle') {
      const circ = new THREE.Mesh(new THREE.CircleGeometry(0.3, 32), artMat);
      circ.position.set(x, y, z + 0.07);
      scene.add(circ);
    } else if (shape === 'square') {
      box(0.5, 0.5, 0.02, artMat, x, y, z + 0.07, false);
    } else {
      const triShape = new THREE.Shape();
      triShape.moveTo(0, 0.35);
      triShape.lineTo(-0.3, -0.2);
      triShape.lineTo(0.3, -0.2);
      triShape.closePath();
      const triGeo = new THREE.ShapeGeometry(triShape);
      const triMesh = new THREE.Mesh(triGeo, artMat);
      triMesh.position.set(x, y, z + 0.07);
      scene.add(triMesh);
    }
  }

  function buildLamp(x, y, z) {
    const rodMat = mat(0x888888, { metalness: 0.5 });
    // Rod
    const rod = new THREE.Mesh(new THREE.CylinderGeometry(0.03, 0.03, 2, 6), rodMat);
    rod.position.set(x, y + 1.5, z);
    scene.add(rod);
    // Shade (inverted cone)
    const shade = new THREE.Mesh(
      new THREE.ConeGeometry(0.35, 0.4, 16, 1, true),
      mat(C.white, { roughness: 0.6, side: THREE.DoubleSide })
    );
    shade.position.set(x, y + 2.3, z);
    shade.rotation.x = Math.PI;
    scene.add(shade);
    // Point light
    const light = new THREE.PointLight(0xFFF0D0, 0.4, 8);
    light.position.set(x, y + 2.1, z);
    scene.add(light);
  }

  function buildSculpture(x, y, z, type, color) {
    // Pedestal
    box(0.6, 1, 0.6, mat(C.white), x, y + 0.5, z, false);

    const sculptMat = mat(color, { roughness: 0.3, metalness: 0.1 });
    let mesh;
    if (type === 'sphere') {
      mesh = new THREE.Mesh(new THREE.SphereGeometry(0.3, 24, 24), sculptMat);
    } else if (type === 'cube') {
      mesh = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.5, 0.5), sculptMat);
    } else {
      mesh = new THREE.Mesh(new THREE.ConeGeometry(0.3, 0.6, 24), sculptMat);
    }
    mesh.position.set(x, y + 1.3, z);
    mesh.castShadow = true;
    scene.add(mesh);
  }

  // ===== HOTSPOTS =====
  function buildHotspots() {
    const markerMat = new THREE.MeshStandardMaterial({
      color: C.yellow,
      emissive: C.yellow,
      emissiveIntensity: 0.5,
      roughness: 0.3,
    });

    hotspotData.forEach((data, i) => {
      // Invisible trigger sphere
      const triggerGeo = new THREE.SphereGeometry(3, 8, 8);
      const triggerMat = new THREE.MeshBasicMaterial({ visible: false });
      const trigger = new THREE.Mesh(triggerGeo, triggerMat);
      trigger.position.set(data.pos[0], data.pos[1], data.pos[2]);
      trigger.userData.hotspotIndex = i;
      scene.add(trigger);
      hotspots.push(trigger);

      // Visible marker (octahedron)
      const markerGeo = new THREE.OctahedronGeometry(0.25, 0);
      const marker = new THREE.Mesh(markerGeo, markerMat.clone());
      marker.position.set(data.pos[0], data.pos[1] + 0.5, data.pos[2]);
      marker.userData.baseY = data.pos[1] + 0.5;
      scene.add(marker);
      hotspotMarkers.push(marker);
    });
  }

  // ===== CONTROLS =====
  function setupControls() {
    controls.addEventListener('lock', () => {
      instructions.classList.add('hidden');
      crosshair.classList.add('visible');
      exitBtn.style.display = 'none';
      if (infoPanelOpen) closeInfoPanel();
    });

    controls.addEventListener('unlock', () => {
      instructions.classList.remove('hidden');
      crosshair.classList.remove('visible');
      exitBtn.style.display = 'block';
      interactPrompt.style.display = 'none';
    });

    instructions.addEventListener('click', () => {
      controls.lock();
    });

    exitBtn.addEventListener('click', exitExperience);
    infoPanelClose.addEventListener('click', closeInfoPanel);

    document.addEventListener('keydown', (e) => {
      if (!running) return;
      switch(e.code) {
        case 'KeyW': case 'ArrowUp': moveState.forward = true; break;
        case 'KeyS': case 'ArrowDown': moveState.backward = true; break;
        case 'KeyA': case 'ArrowLeft': moveState.left = true; break;
        case 'KeyD': case 'ArrowRight': moveState.right = true; break;
        case 'KeyE': handleInteraction(); break;
      }
    });

    document.addEventListener('keyup', (e) => {
      if (!running) return;
      switch(e.code) {
        case 'KeyW': case 'ArrowUp': moveState.forward = false; break;
        case 'KeyS': case 'ArrowDown': moveState.backward = false; break;
        case 'KeyA': case 'ArrowLeft': moveState.left = false; break;
        case 'KeyD': case 'ArrowRight': moveState.right = false; break;
      }
    });

    window.addEventListener('resize', () => {
      if (!running) return;
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  }

  // ===== COLLISION =====
  function checkCollision(pos) {
    const raycaster = new THREE.Raycaster();
    const directions = [
      new THREE.Vector3(1, 0, 0),
      new THREE.Vector3(-1, 0, 0),
      new THREE.Vector3(0, 0, 1),
      new THREE.Vector3(0, 0, -1),
    ];

    for (const dir of directions) {
      raycaster.set(new THREE.Vector3(pos.x, pos.y, pos.z), dir);
      raycaster.far = PLAYER_RADIUS;
      const intersects = raycaster.intersectObjects(collisionMeshes);
      for (const hit of intersects) {
        if (hit.distance < PLAYER_RADIUS) {
          // Push back
          pos.x -= dir.x * (PLAYER_RADIUS - hit.distance);
          pos.z -= dir.z * (PLAYER_RADIUS - hit.distance);
        }
      }
    }

    // Also check doors - allow passage
    return pos;
  }

  function getFloorHeight(pos) {
    const raycaster = new THREE.Raycaster();
    raycaster.set(new THREE.Vector3(pos.x, pos.y + 2, pos.z), new THREE.Vector3(0, -1, 0));
    raycaster.far = 50;
    const intersects = raycaster.intersectObjects(floorMeshes);
    if (intersects.length > 0) {
      // Find the floor just below us
      for (const hit of intersects) {
        if (hit.point.y <= pos.y + 0.5) {
          return hit.point.y;
        }
      }
      return intersects[0].point.y;
    }
    return 0;
  }

  // ===== HOTSPOT INTERACTION =====
  function checkHotspotProximity() {
    if (infoPanelOpen) return;

    const playerPos = camera.position;
    const lookDir = new THREE.Vector3();
    camera.getWorldDirection(lookDir);

    activeHotspot = null;

    for (let i = 0; i < hotspots.length; i++) {
      const hp = hotspots[i];
      const dist = playerPos.distanceTo(hp.position);
      if (dist < 4) {
        // Check look direction
        const toHotspot = new THREE.Vector3().subVectors(hp.position, playerPos).normalize();
        const dot = lookDir.dot(toHotspot);
        if (dot > 0.5) {
          activeHotspot = i;
          break;
        }
      }
    }

    if (activeHotspot !== null) {
      interactPrompt.style.display = 'block';
    } else {
      interactPrompt.style.display = 'none';
    }
  }

  function handleInteraction() {
    if (activeHotspot !== null && !infoPanelOpen) {
      const data = hotspotData[activeHotspot];
      infoPanelTitle.textContent = data.title;
      infoPanelText.textContent = data.text;
      infoPanel.style.display = 'block';
      interactPrompt.style.display = 'none';
      infoPanelOpen = true;
    }
  }

  function closeInfoPanel() {
    infoPanel.style.display = 'none';
    infoPanelOpen = false;
  }

  // ===== ANIMATION LOOP =====
  function animate() {
    if (!running) return;
    requestAnimationFrame(animate);

    const delta = Math.min(clock.getDelta(), 0.1);
    const time = clock.getElapsedTime();

    if (controls.isLocked) {
      // Movement
      direction.z = Number(moveState.forward) - Number(moveState.backward);
      direction.x = Number(moveState.right) - Number(moveState.left);
      direction.normalize();

      velocity.x = direction.x * SPEED * delta;
      velocity.z = direction.z * SPEED * delta;

      controls.moveRight(velocity.x);
      controls.moveForward(velocity.z);

      // Collision
      checkCollision(camera.position);

      // Floor detection
      const floorY = getFloorHeight(camera.position);
      const targetY = floorY + PLAYER_HEIGHT;
      camera.position.y += (targetY - camera.position.y) * Math.min(1, delta * 8);

      // Hotspot proximity
      checkHotspotProximity();
    }

    // Animate hotspot markers (bob + rotate)
    hotspotMarkers.forEach((marker, i) => {
      marker.rotation.y = time * 1.5 + i;
      marker.position.y = marker.userData.baseY + Math.sin(time * 2 + i) * 0.15;
    });

    renderer.render(scene, camera);
  }

  // ===== ENTER / EXIT =====
  function enterExperience() {
    scrollPos = window.scrollY;
    document.body.style.overflow = 'hidden';

    overlay.style.display = 'block';
    overlay.classList.add('active', 'zoom-in');
    overlay.classList.remove('fade-out');

    initScene();

    running = true;
    clock.start();
    animate();

    overlay.addEventListener('animationend', function handler() {
      overlay.classList.remove('zoom-in');
      overlay.removeEventListener('animationend', handler);
    });
  }

  function exitExperience() {
    controls.unlock();
    running = false;

    overlay.classList.add('fade-out');
    overlay.addEventListener('animationend', function handler() {
      overlay.classList.remove('active', 'fade-out');
      overlay.style.display = 'none';
      overlay.removeEventListener('animationend', handler);

      document.body.style.overflow = '';
      window.scrollTo(0, scrollPos);

      // Reset movement state
      moveState.forward = moveState.backward = moveState.left = moveState.right = false;
    });
  }

  // ===== BIND ENTER BUTTON =====
  enterBtn.addEventListener('click', enterExperience);
})();
</script>

</body>
</html>
